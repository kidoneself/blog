# MoviePilot 自动分类不完全手册

::: info 文章信息
发布日期：2024年12月16日  
分类：技术 / 媒体管理 / NAS  
标签：#MoviePilot #qBittorrent #EMBY #媒体管理 #自动化
:::

## 📝 前言

本方案可完美实现自定义分类，包括但不限于（电影、剧集、动漫），且只需一个目录设置即可自动分类。无需为每种媒体类型单独配置目录，大大简化了管理流程。

## 🎯 第一步：目录规划

首先要确认存放媒体的地方以及如何规划。大佬可以跳过这一段，小白最好老老实实按部就班操作。

### 目录结构设置

1. **创建共享目录**
   - 先设置个共享目录，例如：`media`
   - 在该目录下分别创建：
     - `downloads` 目录：存放下载源文件
     - `links` 目录：存放硬链接后的媒体库文件
   - **重要提示**：这两个目录只会占用一份磁盘空间（硬链接的特性）

2. **容器映射配置**
   - 相关容器（MP、QB、EMBY）分别映射该共享目录
   - **保持映射一致**，例如：`/vol3/1000/media:/media`
   - 这样可以确保路径在所有容器中保持一致，避免路径问题

3. **确认检查**
   - 确认以上操作无误后，即可开始正式配置

### 目录结构示例

```
media/
├── downloads/          # 下载目录
│   ├── 电影/
│   ├── 剧集/
│   └── 动漫/
└── links/             # 媒体库目录（硬链接）
    ├── 电影/
    ├── 剧集/
    └── 动漫/
```

---

## 🔧 第二步：qBittorrent 配置

### 1. 启用子分类并配置默认保存路径

<div align="center">
<img src="https://placeholder.com/qbittorrent-settings" alt="qBittorrent 设置" />
</div>

**配置要点**：
- 保存路径要和 MP 的目录配置下载目录保持一致
- **启用子分类**：这样可以按类型自动创建子目录
- **为不完整的文件添加扩展名**：打上勾，避免刚开始下载就触发整理

### 2. 更改默认监听端口

<div align="center">
<img src="https://placeholder.com/qbittorrent-port" alt="端口设置" />
</div>

**重要提醒**：
- 默认 6681 端口可能被运营商封锁
- **必须随机重新选个端口**
- 建议选择 10000-65535 之间的随机端口

---

## ⚙️ 第三步：MoviePilot 配置

### 1. 开启 qBittorrent 自动分类管理

<div align="center">
<img src="https://placeholder.com/moviepilot-auto-category" alt="自动分类设置" />
</div>

**功能说明**：
- 开启该功能后，会在 qBittorrent 自动生成分类并按分类路径下载
- 不开启则没有分类，全部下载到默认目录

### 2. 二级分类策略配置

这是整个配置的**核心部分**，通过 YAML 配置实现灵活的分类策略。

```yaml
movie:
  动漫/动画电影:
    genre_ids: '16'
  电影/港台电影:
    origin_country: 'TW,HK'
  电影/国产电影:
    origin_country: 'CN'
  电影/日韩电影:
    origin_country: 'JP,KP,KR'
  电影/欧美电影:
 
tv:
  动漫/国产动漫:
    genre_ids: '16'
    origin_country: 'CN,TW,HK'
  动漫/欧美动漫:
    genre_ids: '16'
    origin_country: 'US,FR,GB,DE,ES,IT,NL,PT,RU,UK'
  动漫/日本番剧:
    genre_ids: '16'
    origin_country: 'JP'
  其他/纪录影片:
    genre_ids: '99'
  其他/综艺节目:
    genre_ids: '10764,10767'
  剧集/港台剧集:
    origin_country: 'TW,HK'
  剧集/国产剧集:
    origin_country: 'CN'
  剧集/日韩剧集:
    origin_country: 'JP,KP,KR'
  剧集/南亚剧集:
    origin_country: 'TH,IN,SG'
  剧集/欧美剧集:
```

#### 🎨 分类策略解析

**敲重点**：此分类方案不再依靠 TMDB 划分电影、电视剧大类。

**分类规则**：
- **斜杠前面**：一级分类（例如：`动漫`、`电影`、`剧集`、`其他`）
- **斜杠后面**：二级分类（例如：`动画电影`、`国产电影`、`港台剧集`）

**灵活性**：
- 可以把 TMDB 电影类的动画电影，强行塞进动漫大类
- 完全自由发挥，根据个人需求定制分类
- 支持多条件组合（如：`genre_ids` + `origin_country`）

#### 📋 常用分类 ID 参考

| 类型 | genre_ids | 说明 |
|------|-----------|------|
| 动画 | 16 | Animation |
| 纪录片 | 99 | Documentary |
| 真人秀 | 10764 | Reality |
| 脱口秀 | 10767 | Talk |

| 国家/地区 | origin_country | 说明 |
|-----------|----------------|------|
| 中国大陆 | CN | China |
| 香港 | HK | Hong Kong |
| 台湾 | TW | Taiwan |
| 日本 | JP | Japan |
| 韩国 | KR | Korea |
| 美国 | US | United States |

### 3. 目录设置

<div align="center">
<img src="https://placeholder.com/moviepilot-directory" alt="目录设置" />
</div>

#### ⚠️ 关键配置

**重点强调**：
- ✅ **一定要关闭按类型分类**
- ✅ **开启按类别分类**
- ✅ **仅需设置一个目录，不要画蛇添足设置多个目录**

**推荐设置**：
- 下载目录：`/media/downloads`
- 媒体库目录：`/media/links`
- 整理方式：硬链接
- 目录结构：`{一级分类}/{二级分类}/{标题} ({年份})`

---

## 📊 配置效果展示

配置完成后，你的媒体文件会按照以下结构自动整理：

```
media/
├── downloads/                    # 原始下载目录
│   ├── 电影/
│   │   ├── 国产电影/
│   │   ├── 欧美电影/
│   │   └── 日韩电影/
│   └── 剧集/
│       ├── 国产剧集/
│       └── 欧美剧集/
└── links/                        # 媒体库目录（硬链接）
    ├── 电影/
    │   ├── 国产电影/
    │   │   └── 流浪地球 (2019)/
    │   ├── 欧美电影/
    │   │   └── 阿凡达 (2009)/
    │   └── 日韩电影/
    │       └── 你的名字 (2016)/
    ├── 剧集/
    │   ├── 国产剧集/
    │   │   └── 庆余年 (2019)/
    │   └── 欧美剧集/
    │       └── 权力的游戏 (2011)/
    └── 动漫/
        ├── 国产动漫/
        │   └── 斗罗大陆 (2018)/
        └── 日本番剧/
            └── 鬼灭之刃 (2019)/
```

---

## 🚀 工作流程

1. **下载阶段**
   - qBittorrent 根据分类自动将文件下载到 `downloads` 对应的子目录
   - 下载中的文件会有特殊扩展名，不会触发整理

2. **整理阶段**
   - MoviePilot 监控下载完成的文件
   - 根据 TMDB 信息匹配二级分类策略
   - 在 `links` 目录创建硬链接并按规则整理

3. **媒体库扫描**
   - EMBY/Jellyfin/Plex 扫描 `links` 目录
   - 自动识别媒体信息并添加到媒体库

---

## ⚡ 优势总结

1. **统一管理**：只需配置一个目录，避免多目录配置的混乱
2. **灵活分类**：不受 TMDB 限制，完全自定义分类逻辑
3. **节省空间**：硬链接方式，不占用额外存储空间
4. **自动化程度高**：下载完成后自动整理，无需人工干预
5. **易于维护**：统一的配置文件，修改方便

---

## 💡 常见问题

### Q1：为什么要关闭按类型分类？

**A**：因为我们使用的是自定义二级分类策略，不需要再按 TMDB 的 movie/tv 类型进行分类。开启后会导致目录结构混乱。

### Q2：硬链接和软链接有什么区别？

**A**：
- **硬链接**：多个文件名指向同一个数据块，删除源文件不影响链接文件
- **软链接**：类似 Windows 快捷方式，删除源文件会导致链接失效
- **建议使用硬链接**：更安全，且不占用额外空间

### Q3：如何添加新的分类规则？

**A**：在二级分类策略配置中添加新的规则，格式如下：

```yaml
tv:
  你的一级分类/你的二级分类:
    genre_ids: '类型ID'
    origin_country: '国家代码'
```

### Q4：配置后发现分类不正确怎么办？

**A**：
1. 检查 TMDB 信息是否正确（可能识别错误）
2. 检查分类规则的优先级（规则从上到下匹配）
3. 查看 MoviePilot 日志，确认匹配过程

### Q5：已经下载的文件可以重新整理吗？

**A**：可以！在 MoviePilot 中手动触发整理，会重新识别并按新规则分类。

---

## 📚 参考资料

- [MoviePilot 官方文档](https://github.com/jxxghp/MoviePilot)
- [qBittorrent 官方文档](https://www.qbittorrent.org/)
- [TMDB API 文档](https://developers.themoviedb.org/3)

---

## 🎉 结语

通过本文的配置，你可以实现一套完整的自动化媒体管理系统。核心思路就是：**统一目录 + 自定义分类 + 自动整理**。

掌握这套方案后，你可以根据自己的需求进一步定制分类规则，打造专属的媒体库管理系统。

如果觉得本文对你有帮助，欢迎分享给更多需要的朋友！

---

*让媒体管理变得简单高效* 🎬
